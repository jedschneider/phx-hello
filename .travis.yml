language: elixir
elixir:
- 1.7.4
otp_release:
- '20.0'

cache:
  directories:
    - deps
env:
  global:
  - LOCAL_POSTGRES_USERNAME=postgres LOCAL_POSTGRES_PASSWORD=postgres
services: "-postgesql"
addons:
  postgresql: '9.6'
sudo: false
install:
- mix local.rebar --force
- mix local.hex --force
- mix deps.get

jobs:
  include:
    - stage: test
      script: mix test
    - stage: setup
      name: "Ensure setup"
      script: ./ensure_setup
